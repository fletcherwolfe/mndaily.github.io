<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Refugees in Minnesota</title>
	<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body>
	<script type="text/javascript">
		var w = 1600;
		var h = 700;

		//Define map projection
		var projection = d3.geo.mercator()
							   .translate([w/2 - 50, h/2 + 100])
							   .scale([200]);

		//Define path generator
		var path = d3.geo.path()
						 .projection(projection);
						 
		//Define quantize scale to sort data values into buckets of color
		var color = d3.scale.quantize()
							.range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);
							//Colors taken from colorbrewer.js, included in the D3 download

		//Create SVG element
		var svg = d3.select("body")
					.append("svg")
					.attr("width", w)
					.attr("height", h);

		d3.csv("refugees.csv", function(data) {

			color.domain([
				d3.min(data, function(d) { return d.Total; }), 
				d3.max(data, function(d) { return d.Total; })
			]);
		
			d3.json("countries.json", function(json) {

				//Merge the data and GeoJSON
				//Loop through once for each data value
				for (var i = 0; i < data.length; i++) {
			
					var dataCountry = data[i].country;				//Grab country name
					var dataValue = parseFloat(data[i].Total);	//Grab data value, and convert from string to float
			
					//Find the corresponding state inside the GeoJSON
					for (var j = 0; j < json.features.length; j++) {
					
						var jsonCountry = json.features[j].properties.name;
			
						if (dataCountry == jsonCountry) {
					
							//Copy the data value into the JSON
							json.features[j].properties.total = dataValue;
							
							//Stop looking through the JSON
							break;
							
						}
					}		
				}

				//Bind data and create one path per GeoJSON feature
				svg.selectAll("path")
				   .data(json.features)
				   .enter()
				   .append("path")
				   .attr("d", path)
				   .style("stroke", "black")
				   .style("fill", function(d) {
				   		//Get data value
				   		var value = d.properties.total;
				   		
				   		if (value) {
				   			//If value exists…
					   		return color(value);
				   		} else {
				   			//If value is undefined…
					   		return "#ccc";
				   		}				
				   });		

		});
	});


	</script>

	
</body>
</html>